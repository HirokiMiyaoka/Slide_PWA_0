# PWAの概要とライフサイクルを知る

書いてる途中

* 類似技術との簡易比較
* PWAでできること
* ライフサイクル周り

---

## Progressive Web Apps(PWA)とは

PWAとは、HTML5で動作するページをネイティブアプリっぽく実行することが可能になる技術です。

簡単に書けば、Webブラウザで動くWebアプリをそのまま使えるだけでなく、スマートフォンとかPCにインストールして使うみたいなことができます。

有名どころではTwitter（モバイル版）やInstagramなどもPWA対応をしています。

発表当時はChromeでしか対応しておらず、アプリもGoogleやChrome系列でしか積極的に採用していませんでしたが、最近ではWindowsStoreにPWAアプリを公開できるようにするとMicrosoftが公言したり、あんまり実装に乗り気じゃなさそうだったSafariもPWAに必要な機能の実装を進め、iOS 11.3のSafariには搭載予定です。

+++

### PWA以前の様々な取り組み

PWA以前にも実はWebアプリをネイティブアプリっぽく実行する試みがいくつもあります。

とりあえずこれらをまとめてここではWebアプリの「ネイティブアプリ化」技術と呼びます。

* Chromeのアプリケーション化
   * デスクトップにそのWebページを一発で開くショートカットを作る。
   * URLバーの排除など、よりアプリっぽく動作する。
   * 個人的にはPWAの前身と思ってる。かなり昔からChromeに搭載されている機能。
* アクティブデスクトップ/デスクトップガジェット・Windowsサイドバー
   * Windowsに搭載されていたWebアプリをデスクトップに設置する技術。
      * 前者はWin98から正式搭載されていたらしいがVistaで廃止。使ったことない。
      * Vistaではガジェットが搭載され（結構気に入っていたのに）7では廃止。
* Electronとか
   * Chrome+Node.jsを混ぜた各OSで動くアプリに、Webアプリを混ぜてそれっぽく実行する類のやつ。
   * SlackとかVisualStudio Code等採用事例も多いが、ファイル容量が大きい(最小でも100MBクラス)、そこそこWebアプリ以外の実装部分が大きいことが多いので追加のアプリ開発とあまり変わらないデメリットがある。
      * もちろん設計次第ではあるが。
   * それ以外は概ねいい感じだと思っている。

+++

### PWA以前の類似技術はぱっとしない

他にもいろいろとあるはず。

しかし、これらはあまり使われなかったり廃止されたりとあんまりぱっとしないで忘れ去られるのが多いです。

これらは恐らく以下が原因です。

* Webアプリが可能なことが貧弱すぎ、ネイティブアプリとして使うには力不足過ぎた
* 上を補うために独自APIを提供しても、独自仕様なので他で使えない＝開発コストが大きくなる

Electron等は前者の条件を解決しているのでぱっとしないわけではないのかと思いますが、爆発的かと言われるとまだ技術に余力のある、技術者が主に使うアプリしか頑張ってない印象です。（後者の条件は満たしていないが、OSの差異がほぼないのでその分の楽さが他の技術と違ってそこそこいけてる原因かなと。）

PWAでは後者に関してもいくつか工夫することで解決していて、新しくWebサービス作るならついでに導入するのもありだな！っとなる程度には開発工数もそこまで大きくないかなと思います。（最低限の利用なら。最大限でもアプリ追加開発よりはよっぽど楽。）

---

## PWAの特徴

PWAは主に以下の構造で動いています。

* Webアプリ部分
   * 通常のHTML5による実装。
   * PWA対応の場合は登録作業や通信登録作業が少し入るくらいが普通。
* それ以外
   * ブラウザの制御であったりPush通知の処理であったり。
   * WebアプリとPWAの主だった差分部分はここ。

+++

### PWAでできること

* ブラウザの制御
   * 通信やページ立ち上げなど一部ではあるがWebページの領域を超えたブラウザの制御が可能。
* 停止時の活動
   * Webページが開いていなくても、Push通知などを受け取った際にそのアプリに応じた処理が可能。
* デバイスへのインストール
   * スマートフォンのアプリインストールをより簡単にしたようなもの。
   * ページのダウンロード+α程度なのでそんなに時間もかからない。
   * 基本的にOSに依存しているので、場合によってはPWAは対応しているがインストールは対応してないとかいう状況もありうる。

+++

### PWAのメリット

* アプリインストールの煩わしさが軽減
   * PWAはブラウザで動作するので使うだけならインストール不要。多用するならインストール可能。
* アプリ開発しなくてもそれっぽくできる
   * PWAをOSから開くとURLバーが消せたりもできる。後は内部を頑張ればほぼアプリ。
   * 新規Webサービスは初めからPWA対応しておけば、疑似アプリとして利用可能。
      * アプリは審査も必要でコストが高い。
* Single Page Application(SPA)との相性が非常に良い。

### デメリット

* ネイティブよりパフォーマンスは劣る
   * 結局ブラウザの上で動くものなので、パフォーマンスはネイティブに劣る。
* OS/ブラウザの対応が必要
   * 単に動作するだけならブラウザ対応だけでOK。
   * ただし、アプリインストールなどはほぼOSに依存するため、例えばiOSではOSに強く結びついたSafariが対応しない限りPWAを端末にインストールすることはできない。
* SPA以外との相性が悪い
   * ページ遷移がたくさん発生するCGIみたいな形式でもできなくはないが、オフライン対応などで少々辛い。
   * オフライン時の動作を使用不可ページを表示するだけ、というようにばっさり切るならまだいける。

### 考慮するOS/ブラウザ

OSの協力も必要なことを考えると、注視しないといけないのが、以下OS/ブラウザです。

* Android/Chrome
* Mac/iOS/Safari
* Windows/Edge

Firefox等もいろいろ対応していますが、主に上については情報を積極的に集めた方が良いです。

+++

## PWAの動作条件

デメリットにも書きましたが、OS/ブラウザの対応は必須なので、ブラウザで何が必要かを列挙しておきます。

* ServiceWorker
   * https://caniuse.com/#search=Service%20Workers
   * PWAの主機能を担う部分。今回のメイン。
* Web App Manifest
   * https://caniuse.com/#search=Web%20App%20Manifest
   * デバイスへのインストールに必要。
   * iOS Safari用にアイコンとか用意したらWebページをホームに追加した時反映されたと思うが、あれをひとまとめにして分離したもの。

OS標準のブラウザがこれらをサポートしていれば、PWAに対応していると言えます。

---

+++

3

+++

4

---

5

